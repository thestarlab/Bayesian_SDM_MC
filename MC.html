<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
	<title>
		Mormon Cricket Density Estimates
	</title>
	<link rel="stylesheet" href="https://js.arcgis.com/4.24/esri/themes/light/main.css" />
	<script src="https://js.arcgis.com/4.24/"></script>
	<style>
		html,
		body {
			padding: 0;
			margin: 0;
			height: 100%;
			width: 100%;
		}

		#viewDiv {
			padding: 0;
			margin: 0;
			height: 100%;
			width: 100%;
			float: left;
		}

		#infoDiv {
			padding: 8px;
			font-family: Avenir Next W00;
			font-size: 1em;
		}

		#titleDiv {
			padding: 10px;
			width: 320px;
		}

		#titleText {
			font-size: 14pt;
			font-family: 'Times New Roman', Times, serif;
			padding-bottom: 2px;
		}
	</style>
</head>

<body>
	<div id="titleDiv" class="esri-widget">
		<div id="titleText">
			<b>
				Mormon Cricket Density Estimates
			</b>
		</div>
		<div>
			Select Year and State to view estimated Mormon Cricket densities from USDA surveys.
		</div>
	</div>
	<div id="viewDiv"></div>

	<script>
		require([
			"esri/Map",
			"esri/views/MapView",
			"esri/widgets/BasemapGallery",
			"esri/layers/TileLayer",
			"esri/widgets/LayerList",
			"esri/widgets/Legend",
			"esri/widgets/Expand",
			"esri/widgets/Home"
		], function (
			Map,
			MapView,
			BasemapGallery,
			TileLayer,
			LayerList,
			Legend,
			Expand,
			Home
		) {
			var infoDiv = document.getElementById("infoDiv")

			const map = new Map({
				basemap: "topo-vector"
			});

			// const home_center = [-95.3, 29.8]
			const home_center = [-107, 43.4]
			const home_zoom = 7
			const view = new MapView({
				container: "viewDiv",
				map: map,
				center: home_center, // longitude, latitude
				zoom: home_zoom
			});

			view.ui.add("titleDiv", "top-right");

			// Add the home button to the top left corner of the view
			const homeBtn = new Home({
				view: view
			});
			view.ui.add(homeBtn, "top-left");

			function view_go_home() {
				view.goTo({
					center: home_center,
					zoom: home_zoom
				});
			}

			// add year and state filter dropdowns to add or remove layers
			var yearFilter, stateFilter;
			var initialYear = "2019";
			var initialState = "Nevada";
			var year = ["2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020"];
			var states = ["Wyoming", "Nevada", "Idaho"];
			yearFilter = document.createElement("select");
			stateFilter = document.createElement("select");
			filterClass = "esri-widget esri-select";
			filterStyle = "width: 200px; font-family: Avenir Next W00; font-size: 1em;";
			yearFilter.setAttribute("id", "yearSelect");
			yearFilter.setAttribute("class", filterClass);
			yearFilter.setAttribute("style", filterStyle);
			stateFilter.setAttribute("id", "stateSelect");
			stateFilter.setAttribute("class", filterClass);
			stateFilter.setAttribute("style", filterStyle);
			year.forEach(function (sql) {
				var option = document.createElement("option");
				option.value = sql;
				option.innerHTML = "Year: " + sql;
				yearFilter.appendChild(option);
			});
			states.forEach(function (sql) {
				var option = document.createElement("option");
				option.value = sql;
				option.innerHTML = "State: " + sql;
				stateFilter.appendChild(option);
			});
			view.ui.add(yearFilter, "top-right");
			view.ui.add(stateFilter, "top-right");
			yearFilter.value = initialYear;
			stateFilter.value = initialState;
			yearFilter.addEventListener("change", function (event) {
				initialYear = event.target.value;
				updateLayers(initialYear, initialState);
			});
			stateFilter.addEventListener("change", function (event) {
				initialState = event.target.value;
				updateLayers(initialYear, initialState);
			});
			const state_short = {
				"Wyoming": "WY",
				"Nevada": "NV",
				"Idaho": "ID"
			}
			let center_dict = {
				"Wyoming": [-107.2903, 43.07597],
				"Nevada": [-116.4194, 38.8026],
				"Idaho": [-114.742, 44.0682]
			}
			function updateLayers(year, state) {
				map.removeAll();
				const curr_layer = new TileLayer({
					url: "https://tiles.arcgis.com/tiles/b3fMqPOmotX6SV4k/arcgis/rest/services/" + state_short[state] + "_MC_Density_" + year + "/MapServer",
					title: "Estimated Mormon Cricket Density in " + state + " " + year,//state + " Mormon Crickets Density " + year,
					// legendEnabled: false,
					// listMode: "hide",
					listMode: "hide-children",
				})
				map.add(curr_layer);
				view.goTo({
					center: center_dict[state],
					zoom: 7
				});
			}
			updateLayers(initialYear, initialState);

			// ----------------------------------------- Add Basemap Gallery -----------------------------------------
			const basemapGallery = new BasemapGallery({
				view: view,
				container: document.createElement("div")
			});

			// Create an Expand instance and set the content
			// property to the DOM node of the basemap gallery widget
			const bgExpand = new Expand({
				view: view,
				content: basemapGallery
			});

			// Add the expand instance to the ui
			view.ui.add(bgExpand, "top-left");

			// ----------------------------------------- Add LayerList & Legend widget -----------------------------------------
			view.ui.add(new LayerList({
				view: view
			}), "bottom-right");

			view.ui.add(new Legend({
				view: view
			}), "bottom-left");

		});
	</script>
</body>

</html>